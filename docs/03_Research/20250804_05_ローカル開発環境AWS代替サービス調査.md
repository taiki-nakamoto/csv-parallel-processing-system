# ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒAWSä»£æ›¿ã‚µãƒ¼ãƒ“ã‚¹èª¿æŸ»

## 1. èª¿æŸ»æ¦‚è¦

### 1.1 ç›®çš„
CSVãƒ•ã‚¡ã‚¤ãƒ«ä¸¦åˆ—å‡¦ç†ã‚·ã‚¹ãƒ†ãƒ ã®é–‹ç™ºã«ãŠã„ã¦ã€ä»¥ä¸‹ã®AWSã‚µãƒ¼ãƒ“ã‚¹ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒï¼ˆDockerï¼‰ã§å†ç¾ã™ã‚‹ãŸã‚ã®ä»£æ›¿æ‰‹æ®µã‚’èª¿æŸ»ã™ã‚‹ã€‚

### 1.2 èª¿æŸ»å¯¾è±¡ã‚µãƒ¼ãƒ“ã‚¹
- S3 â†’ MinIO
- EventBridge â†’ AWS SAM or ä»£æ›¿æ‰‹æ®µ
- Step Functions â†’ AWS SAM or ä»£æ›¿æ‰‹æ®µ
- Lambda â†’ AWS SAM
- DynamoDB â†’ AWS SAM
- Aurora â†’ PostgreSQL

### 1.3 èª¿æŸ»çµæœã‚µãƒãƒªãƒ¼

| AWSã‚µãƒ¼ãƒ“ã‚¹ | ãƒ­ãƒ¼ã‚«ãƒ«ä»£æ›¿æ‰‹æ®µ | æ¨å¥¨åº¦ | ä¸»ãªç‰¹å¾´ |
|-------------|------------------|--------|----------|
| S3 | MinIO | â­â­â­â­â­ | é«˜ã„S3 APIäº’æ›æ€§ã€Dockerã§ç°¡å˜æ§‹ç¯‰ |
| EventBridge | LocalStack | â­â­â­â­ | SAMéå¯¾å¿œã€LocalStackã§é«˜æ©Ÿèƒ½ |
| Step Functions | LocalStack | â­â­â­ | SAMé™å®šçš„ã€LocalStackãŒå®Ÿç”¨çš„ |
| Lambda | AWS SAM Local | â­â­â­â­â­ | å…¬å¼ã‚µãƒãƒ¼ãƒˆã€Dockerçµ±åˆå„ªç§€ |
| DynamoDB | DynamoDB Local | â­â­â­â­â­ | AWSå…¬å¼ã€SAMçµ±åˆè‰¯å¥½ |
| Aurora | PostgreSQL + local-data-api | â­â­â­â­ | Data APIå¯¾å¿œã€Serverlessæ¨¡æ“¬å¯èƒ½ |

## 2. S3 â†’ MinIO

### 2.1 æ¦‚è¦
MinIOã¯é«˜ã„S3 APIäº’æ›æ€§ã‚’æŒã¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã€‚

### 2.2 Dockeræ§‹æˆä¾‹
```yaml
# docker-compose.yml
version: '3.8'
services:
  minio:
    image: minio/minio:latest
    container_name: csv-minio
    ports:
      - "9000:9000"     # API
      - "9001:9001"     # Console
    environment:
      MINIO_ROOT_USER: admin
      MINIO_ROOT_PASSWORD: admin123456
      MINIO_DEFAULT_BUCKETS: csv-input-files,csv-processed-files,csv-error-files
    command: server /data --console-address ":9001"
    volumes:
      - minio_data:/data
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9000/minio/health/live"]
      interval: 30s
      timeout: 20s
      retries: 3

volumes:
  minio_data:
```

### 2.3 S3 APIäº’æ›æ€§
#### å¯¾å¿œæ©Ÿèƒ½
- âœ… ãƒã‚±ãƒƒãƒˆæ“ä½œï¼ˆä½œæˆã€å‰Šé™¤ã€ä¸€è¦§ï¼‰
- âœ… ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ“ä½œï¼ˆPUTã€GETã€DELETEï¼‰
- âœ… ãƒ—ãƒªã‚µã‚¤ãƒ³ãƒ‰URL
- âœ… Multipart Upload
- âœ… CORSè¨­å®š
- âœ… ãƒã‚±ãƒƒãƒˆãƒãƒªã‚·ãƒ¼
- âœ… ã‚¤ãƒ™ãƒ³ãƒˆé€šçŸ¥ï¼ˆWebhookã€MQTTã€AMQPï¼‰

#### åˆ¶é™äº‹é …
- âŒ S3ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ï¼ˆã‚·ãƒ³ã‚°ãƒ«ã‚µãƒ¼ãƒãƒ¼ãƒ¢ãƒ¼ãƒ‰ï¼‰
- âŒ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ­ãƒƒã‚¯
- âŒ Cross-Region Replication
- âŒ S3 Selectï¼ˆä¸€éƒ¨åˆ¶é™ï¼‰

### 2.4 è¨­å®šæ–¹æ³•
```bash
# ãƒã‚±ãƒƒãƒˆä½œæˆã¨ãƒãƒªã‚·ãƒ¼è¨­å®š
docker exec csv-minio mc alias set local http://localhost:9000 admin admin123456
docker exec csv-minio mc mb local/csv-input-files
docker exec csv-minio mc mb local/csv-processed-files
docker exec csv-minio mc mb local/csv-error-files

# åŒ¿åèª­ã¿å–ã‚Šè¨±å¯
docker exec csv-minio mc anonymous set public local/csv-processed-files
```

## 3. EventBridge

### 3.1 AWS SAM Localå¯¾å¿œçŠ¶æ³
- âŒ **AWS SAM Local**: EventBridgeç›´æ¥ã‚µãƒãƒ¼ãƒˆãªã—
- âš ï¸ SAMã§ã¯`Events`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§EventBridge Ruleã¯å®šç¾©å¯èƒ½ã ãŒã€ãƒ­ãƒ¼ã‚«ãƒ«å®Ÿè¡Œä¸å¯

### 3.2 æ¨å¥¨ä»£æ›¿æ‰‹æ®µ: LocalStack
LocalStackã¯EventBridge APIã‚’åŒ…æ‹¬çš„ã«ã‚µãƒãƒ¼ãƒˆã€‚

#### Dockeræ§‹æˆ
```yaml
services:
  localstack:
    image: localstack/localstack:3.0
    container_name: csv-localstack
    ports:
      - "4566:4566"
    environment:
      - SERVICES=events,stepfunctions,lambda,dynamodb,s3
      - DEBUG=1
      - PERSISTENCE=1
      - LAMBDA_EXECUTOR=docker
      - DOCKER_HOST=unix:///var/run/docker.sock
    volumes:
      - ./localstack-data:/var/lib/localstack
      - /var/run/docker.sock:/var/run/docker.sock
```

#### EventBridgeæ©Ÿèƒ½å¯¾å¿œ
- âœ… ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ™ãƒ³ãƒˆãƒã‚¹
- âœ… ãƒ«ãƒ¼ãƒ«ã¨ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ
- âœ… ã‚¤ãƒ™ãƒ³ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°
- âœ… Lambdaã€Step Functionsé€£æº
- âš ï¸ EventBridge Pipesï¼ˆå…¥åŠ›å¤‰æ›ã€åŒæ™‚å®Ÿè¡Œæ•°åˆ¶é™ã‚ã‚Šï¼‰

#### ä½¿ç”¨ä¾‹
```bash
# ã‚¤ãƒ™ãƒ³ãƒˆãƒ«ãƒ¼ãƒ«ä½œæˆ
aws --endpoint-url=http://localhost:4566 events put-rule \
  --name csv-processing-rule \
  --event-pattern '{"source":["aws.s3"],"detail-type":["Object Created"]}'

# Lambdaé–¢æ•°ã‚’ã‚¿ãƒ¼ã‚²ãƒƒãƒˆè¨­å®š
aws --endpoint-url=http://localhost:4566 events put-targets \
  --rule csv-processing-rule \
  --targets "Id"="1","Arn"="arn:aws:lambda:us-east-1:000000000000:function:csv-processor"
```

### 3.3 è»½é‡ä»£æ›¿æ‰‹æ®µ: ã‚«ã‚¹ã‚¿ãƒ EventBridge
```typescript
// local-eventbridge.ts
interface EventBridgeEvent {
  source: string;
  'detail-type': string;
  detail: any;
}

class LocalEventBridge {
  private rules: Map<string, Function[]> = new Map();

  putRule(pattern: string, handler: Function) {
    if (!this.rules.has(pattern)) {
      this.rules.set(pattern, []);
    }
    this.rules.get(pattern)!.push(handler);
  }

  putEvent(event: EventBridgeEvent) {
    this.rules.forEach((handlers, pattern) => {
      if (this.matchPattern(event, pattern)) {
        handlers.forEach(handler => handler(event));
      }
    });
  }
}
```

## 4. Step Functions

### 4.1 AWS SAM Localå¯¾å¿œçŠ¶æ³
- âš ï¸ **é™å®šçš„ã‚µãƒãƒ¼ãƒˆ**: åŸºæœ¬çš„ãªçŠ¶æ…‹é·ç§»ã®ã¿
- âŒ **åˆ†æ•£ãƒãƒƒãƒ—**: ã‚µãƒãƒ¼ãƒˆãªã—
- âŒ **è¤‡é›‘ãªASL**: ä¸€éƒ¨æ©Ÿèƒ½åˆ¶é™
- âŒ **AWSå…¬å¼Step Functions Local**: 2024å¹´ç¾åœ¨ã€Œunsupportedã€ãƒãƒ¼ã‚¯

### 4.2 æ¨å¥¨ä»£æ›¿æ‰‹æ®µ: LocalStack
LocalStackã®Step Functionså®Ÿè£…ãŒæœ€ã‚‚å®Ÿç”¨çš„ã€‚

#### 2024å¹´æ–°æ©Ÿèƒ½
- âœ… JSONataå¼ã‚µãƒãƒ¼ãƒˆ
- âœ… å¤‰æ•°ï¼ˆVariablesï¼‰æ©Ÿèƒ½
- âœ… åˆ†æ•£ãƒãƒƒãƒ—ï¼ˆDistributed Mapï¼‰åŸºæœ¬ã‚µãƒãƒ¼ãƒˆ
- âœ… Express Workflow
- âœ… Standard Workflow

#### ä½¿ç”¨ä¾‹
```bash
# ã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³ä½œæˆ
aws --endpoint-url=http://localhost:4566 stepfunctions create-state-machine \
  --name csv-processing-workflow \
  --definition file://state-machine.json \
  --role-arn arn:aws:iam::000000000000:role/StepFunctionsRole

# å®Ÿè¡Œé–‹å§‹
aws --endpoint-url=http://localhost:4566 stepfunctions start-execution \
  --state-machine-arn arn:aws:states:us-east-1:000000000000:stateMachine:csv-processing-workflow \
  --name execution-1 \
  --input '{"inputFile": "test.csv"}'
```

#### ASLä¾‹ï¼ˆåˆ†æ•£ãƒãƒƒãƒ—å¯¾å¿œï¼‰
```json
{
  "Comment": "CSV Parallel Processing with Distributed Map",
  "StartAt": "DistributedMap",
  "States": {
    "DistributedMap": {
      "Type": "Map",
      "ItemProcessor": {
        "ProcessorConfig": {
          "Mode": "DISTRIBUTED",
          "ExecutionType": "EXPRESS"
        },
        "StartAt": "ProcessChunk",
        "States": {
          "ProcessChunk": {
            "Type": "Task",
            "Resource": "arn:aws:lambda:us-east-1:000000000000:function:csv-processor",
            "End": true
          }
        }
      },
      "ItemsPath": "$.chunks",
      "End": true
    }
  }
}
```

### 4.3 åˆ¶é™äº‹é …
- âš ï¸ LocalStack Proæ©Ÿèƒ½ï¼ˆä¸€éƒ¨é«˜åº¦ãªæ©Ÿèƒ½ï¼‰
- âš ï¸ AWS Step Functionså›ºæœ‰ã®æœ€é©åŒ–ãªã—
- âš ï¸ å®Œå…¨ãªåˆ†æ•£ãƒãƒƒãƒ—ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å†ç¾ä¸å¯

## 5. Lambda â†’ AWS SAM Local

### 5.1 æ¦‚è¦
AWS SAM Localã¯Lambdaé–‹ç™ºã«ãŠã„ã¦æœ€ã‚‚å„ªç§€ãªãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã€‚

### 5.2 ä¸»è¦æ©Ÿèƒ½
#### 2024å¹´æ–°æ©Ÿèƒ½
- âœ… ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‚µãƒãƒ¼ãƒˆï¼ˆæœ€å¤§10GBï¼‰
- âœ… ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›ºæœ‰ãƒ“ãƒ«ãƒ‰ï¼ˆx86_64/arm64ï¼‰
- âœ… Terraformé€£æºå¼·åŒ–
- âœ… æ”¹è‰¯ã•ã‚ŒãŸãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰

#### SAMã‚³ãƒãƒ³ãƒ‰ä¾‹
```bash
# ãƒ­ãƒ¼ã‚«ãƒ«é–¢æ•°å®Ÿè¡Œ
sam local invoke csv-processor --event events/s3-event.json

# APIã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤æ¨¡æ“¬
sam local start-api --port 3000

# Lambdaå®Ÿè¡Œç’°å¢ƒæ¨¡æ“¬
sam local start-lambda --port 3001
```

### 5.3 Dockerçµ±åˆ
```yaml
# template.yamlæŠœç²‹
Resources:
  CsvProcessorFunction:
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: src/
      Handler: index.handler
      Runtime: nodejs18.x
      Environment:
        Variables:
          DYNAMODB_ENDPOINT: http://dynamodb:8000
          S3_ENDPOINT: http://minio:9000
      Events:
        S3Event:
          Type: S3
          Properties:
            Bucket: !Ref S3Bucket
            Events: s3:ObjectCreated:*
```

### 5.4 åˆ¶é™äº‹é …
- âš ï¸ ã‚¤ãƒ™ãƒ³ãƒˆã‚½ãƒ¼ã‚¹ãŒå®Ÿéš›ã®AWSã¨ç•°ãªã‚‹å ´åˆãŒã‚ã‚‹
- âš ï¸ VPCè¨­å®šã®å®Œå…¨ãªå†ç¾ä¸å¯
- âš ï¸ IAMãƒ­ãƒ¼ãƒ«ãƒ»ãƒãƒªã‚·ãƒ¼ã®å®Ÿéš›ã®å‹•ä½œã¨å·®ç•°

## 6. DynamoDB â†’ DynamoDB Local

### 6.1 æ¦‚è¦
Amazon DynamoDB Localã¯AWSå…¬å¼ã®ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºãƒ„ãƒ¼ãƒ«ã€‚

### 6.2 Dockeræ§‹æˆ
```yaml
services:
  dynamodb:
    image: amazon/dynamodb-local:2.0.0
    container_name: csv-dynamodb
    ports:
      - "8000:8000"
    environment:
      - JAVA_OPTS=-Xmx1G
    command: ["-jar", "DynamoDBLocal.jar", "-sharedDb", "-inMemory", "-port", "8000"]
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/shell/ || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
```

### 5.3 SAMçµ±åˆ
```yaml
# samconfig.toml
[default.local_start_api.parameters]
docker_network = "csv-local-network"

[default.local_start_lambda.parameters]
docker_network = "csv-local-network"
```

#### ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®š
```bash
# Docker ã‚«ã‚¹ã‚¿ãƒ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä½œæˆ
docker network create csv-local-network

# DynamoDBã‚’ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«æ¥ç¶š
docker run --network csv-local-network --name csv-dynamodb -p 8000:8000 amazon/dynamodb-local
```

### 6.4 ãƒ†ãƒ¼ãƒ–ãƒ«åˆæœŸåŒ–
```bash
# ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
aws dynamodb create-table \
  --endpoint-url http://localhost:8000 \
  --table-name csv_audit_logs \
  --attribute-definitions \
    AttributeName=execution_id,AttributeType=S \
    AttributeName=timestamp,AttributeType=S \
  --key-schema \
    AttributeName=execution_id,KeyType=HASH \
    AttributeName=timestamp,KeyType=RANGE \
  --billing-mode PAY_PER_REQUEST
```

### 6.5 2024å¹´æ–°æ©Ÿèƒ½
- âœ… ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªãƒ¢ãƒ¼ãƒ‰ï¼ˆé«˜é€ŸåŒ–ï¼‰
- âœ… Java 17ã‚µãƒãƒ¼ãƒˆ
- âœ… ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„

## 7. Aurora â†’ PostgreSQL + local-data-api

### 7.1 æ¦‚è¦
Aurora Serverlessã®Data APIã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§æ¨¡æ“¬ã™ã‚‹ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã€‚

### 7.2 Docker Composeæ§‹æˆ
```yaml
services:
  postgres:
    image: postgres:15-alpine
    container_name: csv-postgres
    ports:
      - "5432:5432"
    environment:
      POSTGRES_DB: csv_processing
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./init.sql:/docker-entrypoint-initdb.d/init.sql

  local-data-api:
    image: koxudaxi/local-data-api:latest
    container_name: csv-data-api
    ports:
      - "8080:80"
    environment:
      POSTGRES_HOST: postgres
      POSTGRES_PORT: 5432
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
      POSTGRES_DB: csv_processing
      RESOURCE_ARN: 'arn:aws:rds:us-east-1:123456789012:cluster:csv-cluster'
      SECRET_ARN: 'arn:aws:secretsmanager:us-east-1:123456789012:secret:csv-secret'
    depends_on:
      - postgres

volumes:
  postgres_data:
```

### 7.3 Data APIä½¿ç”¨ä¾‹
```typescript
// Aurora Data APIäº’æ›ã®ä½¿ç”¨æ–¹æ³•
import { RDSDataClient, ExecuteStatementCommand } from '@aws-sdk/client-rds-data';

const client = new RDSDataClient({
  endpoint: 'http://localhost:8080',
  region: 'us-east-1',
  credentials: {
    accessKeyId: 'test',
    secretAccessKey: 'test'
  }
});

const command = new ExecuteStatementCommand({
  resourceArn: 'arn:aws:rds:us-east-1:123456789012:cluster:csv-cluster',
  secretArn: 'arn:aws:secretsmanager:us-east-1:123456789012:secret:csv-secret',
  database: 'csv_processing',
  sql: 'SELECT * FROM processing_jobs WHERE status = :status',
  parameters: [
    {
      name: 'status',
      value: { stringValue: 'processing' }
    }
  ]
});

const result = await client.send(command);
```

### 7.4 åˆæœŸåŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆä¾‹
```sql
-- init.sql
CREATE TABLE processing_jobs (
    id SERIAL PRIMARY KEY,
    execution_id VARCHAR(255) NOT NULL,
    file_name VARCHAR(500) NOT NULL,
    total_records INTEGER,
    processed_records INTEGER DEFAULT 0,
    error_records INTEGER DEFAULT 0,
    status VARCHAR(50) DEFAULT 'pending',
    started_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    completed_at TIMESTAMP WITH TIME ZONE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_processing_jobs_execution_id ON processing_jobs(execution_id);
CREATE INDEX idx_processing_jobs_status ON processing_jobs(status);
```

### 7.5 Aurora Serverless v2ã¨ã®é•ã„
- âŒ Scale-to-zeroæ©Ÿèƒ½ãªã—ï¼ˆ2024å¹´ç¾åœ¨Aurora Serverless v2ã‚‚éå¯¾å¿œï¼‰
- âŒ è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°æ©Ÿèƒ½ãªã—
- âœ… Data APIå®Œå…¨äº’æ›
- âœ… PostgreSQLæ¨™æº–æ©Ÿèƒ½ã™ã¹ã¦ä½¿ç”¨å¯èƒ½

## 8. çµ±åˆDocker Composeæ§‹æˆ

### 8.1 å…¨ã‚µãƒ¼ãƒ“ã‚¹çµ±åˆä¾‹
```yaml
version: '3.8'
services:
  # S3ä»£æ›¿: MinIO
  minio:
    image: minio/minio:latest
    container_name: csv-minio
    ports:
      - "9000:9000"
      - "9001:9001"
    environment:
      MINIO_ROOT_USER: admin
      MINIO_ROOT_PASSWORD: admin123456
    command: server /data --console-address ":9001"
    volumes:
      - minio_data:/data
    networks:
      - csv-local-network

  # EventBridge + Step Functionsä»£æ›¿: LocalStack
  localstack:
    image: localstack/localstack:3.0
    container_name: csv-localstack
    ports:
      - "4566:4566"
    environment:
      - SERVICES=events,stepfunctions,lambda,s3
      - DEBUG=1
      - PERSISTENCE=1
      - LAMBDA_EXECUTOR=docker
    volumes:
      - ./localstack-data:/var/lib/localstack
      - /var/run/docker.sock:/var/run/docker.sock
    networks:
      - csv-local-network

  # DynamoDB Local
  dynamodb:
    image: amazon/dynamodb-local:2.0.0
    container_name: csv-dynamodb
    ports:
      - "8000:8000"
    command: ["-jar", "DynamoDBLocal.jar", "-sharedDb", "-inMemory", "-port", "8000"]
    networks:
      - csv-local-network

  # Auroraä»£æ›¿: PostgreSQL
  postgres:
    image: postgres:15-alpine
    container_name: csv-postgres
    ports:
      - "5432:5432"
    environment:
      POSTGRES_DB: csv_processing
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./init.sql:/docker-entrypoint-initdb.d/init.sql
    networks:
      - csv-local-network

  # Aurora Data APIä»£æ›¿
  local-data-api:
    image: koxudaxi/local-data-api:latest
    container_name: csv-data-api
    ports:
      - "8080:80"
    environment:
      POSTGRES_HOST: postgres
      POSTGRES_PORT: 5432
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
      POSTGRES_DB: csv_processing
      RESOURCE_ARN: 'arn:aws:rds:us-east-1:123456789012:cluster:csv-cluster'
      SECRET_ARN: 'arn:aws:secretsmanager:us-east-1:123456789012:secret:csv-secret'
    depends_on:
      - postgres
    networks:
      - csv-local-network

volumes:
  minio_data:
  postgres_data:

networks:
  csv-local-network:
    driver: bridge
```

### 8.2 SAMçµ±åˆè¨­å®š
```toml
# samconfig.toml
[default.local_start_api.parameters]
docker_network = "csv-local-network"
env_vars = "env.json"

[default.local_start_lambda.parameters]
docker_network = "csv-local-network"
env_vars = "env.json"

[default.local_invoke.parameters]
docker_network = "csv-local-network"
env_vars = "env.json"
```

```json
// env.json
{
  "CsvProcessorFunction": {
    "S3_ENDPOINT": "http://minio:9000",
    "DYNAMODB_ENDPOINT": "http://dynamodb:8000",
    "POSTGRES_ENDPOINT": "http://local-data-api:80",
    "EVENTBRIDGE_ENDPOINT": "http://localstack:4566",
    "STEPFUNCTIONS_ENDPOINT": "http://localstack:4566"
  }
}
```

## 9. é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

### 9.1 èµ·å‹•æ‰‹é †
```bash
# 1. Docker Composeèµ·å‹•
docker-compose up -d

# 2. MinIOãƒã‚±ãƒƒãƒˆåˆæœŸåŒ–
./scripts/init-minio.sh

# 3. DynamDBãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
./scripts/init-dynamodb.sh

# 4. PostgreSQLåˆæœŸãƒ‡ãƒ¼ã‚¿æŠ•å…¥
./scripts/init-postgres.sh

# 5. LocalStack EventBridge/Step Functionsè¨­å®š
./scripts/init-localstack.sh

# 6. SAM Lambdaèµ·å‹•
sam local start-api --docker-network csv-local-network
```

### 9.2 ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
```bash
# Lambdaå˜ä½“ãƒ†ã‚¹ãƒˆ
sam local invoke csv-processor --event events/s3-create-event.json --docker-network csv-local-network

# APIçµŒç”±ãƒ†ã‚¹ãƒˆ
curl -X POST http://localhost:3000/api/process \
  -H "Content-Type: application/json" \
  -d '{"bucket": "csv-input-files", "key": "test.csv"}'

# Step Functionså®Ÿè¡Œãƒ†ã‚¹ãƒˆ
aws --endpoint-url=http://localhost:4566 stepfunctions start-execution \
  --state-machine-arn arn:aws:states:us-east-1:000000000000:stateMachine:csv-processing-workflow \
  --input '{"inputFile": "test.csv"}'
```

## 10. åˆ¶é™äº‹é …ã¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### 10.1 å…¨ä½“çš„ãªåˆ¶é™äº‹é …
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: å®Ÿéš›ã®AWSã‚ˆã‚Šä½é€Ÿ
- **ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°**: å˜ä¸€ãƒã‚·ãƒ³åˆ¶é™
- **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯**: ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ãƒ»ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆç‰¹æ€§ã®é•ã„
- **IAM**: å®Œå…¨ãªæ¨©é™åˆ¶å¾¡ã®å†ç¾ä¸å¯
- **ç›£è¦–**: CloudWatchç›¸å½“ã®ç›£è¦–æ©Ÿèƒ½ãªã—

### 10.2 æ¨å¥¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹
1. **æ®µéšçš„ãƒ†ã‚¹ãƒˆ**: ãƒ­ãƒ¼ã‚«ãƒ« â†’ é–‹ç™ºç’°å¢ƒ â†’ æœ¬ç•ªç’°å¢ƒ
2. **è¨­å®šå¤–éƒ¨åŒ–**: ç’°å¢ƒå¤‰æ•°ãƒ»è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆåˆ‡ã‚Šæ›¿ãˆ
3. **ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿**: å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’æ¨¡æ“¬ã—ãŸé–‹ç™ºç”¨ãƒ‡ãƒ¼ã‚¿ä½œæˆ
4. **CI/CDçµ±åˆ**: GitHub Actionsã§ã‚‚LocalStackä½¿ç”¨
5. **å®šæœŸåŒæœŸ**: æœ¬ç‰©ã®AWSç’°å¢ƒã¨ã®å·®åˆ†ç¢ºèª

### 10.3 ã‚³ã‚¹ãƒˆåŠ¹æœ
- **é–‹ç™ºã‚³ã‚¹ãƒˆå‰Šæ¸›**: ç´„80-90%ã®AWSåˆ©ç”¨æ–™å‰Šæ¸›
- **é–‹ç™ºåŠ¹ç‡**: è¿…é€Ÿãªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ«ãƒ¼ãƒ—
- **å­¦ç¿’ã‚³ã‚¹ãƒˆ**: å„ãƒ„ãƒ¼ãƒ«ã®å­¦ç¿’æ™‚é–“è¦
- **ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹**: Dockerç’°å¢ƒã®ç®¡ç†ã‚³ã‚¹ãƒˆ

## 11. çµè«–

### 11.1 æ¨å¥¨æ§‹æˆ
```
ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒ = MinIO + LocalStack + AWS SAM Local + DynamoDB Local + PostgreSQL + local-data-api
```

### 11.2 å®Ÿè£…å„ªå…ˆåº¦
1. **Phase 1**: AWS SAM Local + DynamoDB Local + PostgreSQLï¼ˆåŸºæœ¬Lambdaé–‹ç™ºï¼‰
2. **Phase 2**: MinIOè¿½åŠ ï¼ˆS3é€£æºãƒ†ã‚¹ãƒˆï¼‰
3. **Phase 3**: LocalStackè¿½åŠ ï¼ˆEventBridge + Step Functionsçµ±åˆï¼‰
4. **Phase 4**: local-data-apiè¿½åŠ ï¼ˆAurora Data APIå¯¾å¿œï¼‰

### 11.3 æœŸå¾…åŠ¹æœ
- ğŸ“ˆ **é–‹ç™ºåŠ¹ç‡**: 50-70%å‘ä¸Š
- ğŸ’° **ã‚³ã‚¹ãƒˆå‰Šæ¸›**: 80-90%å‰Šæ¸›
- ğŸš€ **ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯**: å®Ÿæ™‚é–“ãƒ†ã‚¹ãƒˆå¯èƒ½
- ğŸ”§ **ãƒ‡ãƒãƒƒã‚°**: ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒãƒƒã‚°ç’°å¢ƒ