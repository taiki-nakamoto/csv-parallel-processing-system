# GitHub環境準備作業計画

## 1. ドキュメント情報

| 項目 | 内容 |
|------|------|
| ドキュメント名 | GitHub環境準備作業計画 |
| バージョン | 1.0 |
| 作成日 | 2025-08-04 |
| 作成者 | システム開発チーム |
| 調査目的 | GitHub環境準備の作業手順整理と実装計画 |

## 2. 調査概要

CSVファイル並列処理システムのGitHub環境準備について、以下の項目を整理・計画します：

### 2.1 対象GitHubアカウント
- **GitHubアカウント**: taiki-nakamoto
- **アカウントURL**: https://github.com/taiki-nakamoto?tab=repositories
- **アクセス権限**: 個人アカウント（フル権限）

### 2.2 準備項目
1. GitHubリポジトリ作成
2. ブランチ戦略とブランチ保護設定
3. GitHub Actions Secrets設定
4. 初期ディレクトリ構成作成

## 3. GitHubリポジトリ作成手順

### 3.1 リポジトリ基本設定

#### 決定事項
| 項目 | 設定内容 | 理由 |
|------|----------|------|
| **リポジトリ名** | csv-parallel-processing-system | 製造準備ドキュメントで決定済み |
| **アクセス** | Private | ビジネスロジック保護のため |
| **初期化** | README.md, .gitignore作成 | 基本ファイル準備 |
| **ライセンス** | 設定しない | プライベートリポジトリのため |

#### 作成手順
1. **GitHubにアクセス**
   - https://github.com/taiki-nakamoto にアクセス
   - 「New repository」ボタンをクリック

2. **基本情報入力**
   ```
   Repository name: csv-parallel-processing-system
   Description: CSVファイル並列処理システム - AWS Lambda + Step Functions
   Visibility: Private
   Initialize: ✓ Add a README file
                ✓ Add .gitignore (Node template)
   ```

3. **リポジトリ作成**
   - 「Create repository」ボタンをクリック
   - 作成完了を確認

### 3.2 ローカル環境との接続

#### Git設定確認
```bash
# Git設定確認
git config --global user.name
git config --global user.email

# 必要に応じて設定
git config --global user.name "taiki-nakamoto"
git config --global user.email "your-email@example.com"
```

#### ローカルリポジトリ初期化
```bash
# プロジェクトディレクトリ作成
mkdir csv-parallel-processing-system
cd csv-parallel-processing-system

# リモートリポジトリをクローン
git clone https://github.com/taiki-nakamoto/csv-parallel-processing-system.git .

# 初期状態確認
git status
git remote -v
```

## 4. ブランチ戦略と保護設定

### 4.1 ブランチ戦略決定

#### GitFlow戦略を採用
```
main      ← 本番リリース用（保護対象）
develop   ← 開発統合用（保護対象）
feature/* ← 機能開発用（一時的）
hotfix/*  ← 緊急修正用（一時的）
```

#### ブランチ保護ルール設定項目

**mainブランチ保護設定**
- ✅ Require a pull request before merging
- ✅ Require approvals (1名以上)
- ✅ Dismiss stale reviews when new commits are pushed
- ✅ Require status checks to pass before merging
- ✅ Require branches to be up to date before merging
- ✅ Require linear history
- ✅ Include administrators

**developブランチ保護設定**
- ✅ Require a pull request before merging
- ✅ Require status checks to pass before merging
- ✅ Require branches to be up to date before merging
- ❌ Require approvals（開発効率のため不要）

### 4.2 ブランチ保護設定手順

1. **リポジトリSettings画面へ**
   - Settings > Branches に移動

2. **mainブランチ保護ルール追加**
   ```
   Branch name pattern: main
   Rule settings: （上記mainブランチ保護設定に従い設定）
   ```

3. **developブランチ保護ルール追加**
   ```
   Branch name pattern: develop
   Rule settings: （上記developブランチ保護設定に従い設定）
   ```

4. **設定確認**
   - 設定内容をレビューして保存

## 5. GitHub Actions Secrets設定

### 5.1 設定が必要なSecrets

#### AWS関連Secrets
| Secret名 | 設定値 | 用途 |
|----------|--------|------|
| `AWS_ACCESS_KEY_ID` | （AWSアクセスキー） | AWS認証 |
| `AWS_SECRET_ACCESS_KEY` | （AWSシークレットキー） | AWS認証 |
| `AWS_REGION` | ap-northeast-1 | AWSリージョン指定 |
| `S3_TFSTATE_BUCKET` | naka-enginner-tfstate | Terraform State保存先 |
| `S3_SAM_ARTIFACTS_BUCKET` | naka-sam-artifacts | SAM Artifacts保存先 |

### 5.2 Secrets設定手順

1. **Settings画面へ移動**
   - Repository Settings > Secrets and variables > Actions

2. **各Secretを追加**
   ```
   New repository secret をクリック
   Name: AWS_ACCESS_KEY_ID
   Secret: （実際のアクセスキーを入力）
   Add secret をクリック
   
   （以下、他のSecretsも同様に追加）
   ```

3. **設定確認**
   - 全てのSecretsが正しく設定されていることを確認

### 5.3 Environments設定（オプション）

#### 環境分離設定
```
Development Environment:
  - 環境名: development
  - Deployment branches: develop, feature/*
  - Environment secrets: 開発環境用の設定値

Production Environment:
  - 環境名: production
  - Deployment branches: main
  - Environment secrets: 本番環境用の設定値
  - Required reviewers: 設定（本番デプロイ承認用）
```

## 6. 初期ディレクトリ構成作成

### 6.1 プロジェクト構成設計

製造準備ドキュメントで決定された構成に従います：

```
csv-parallel-processing-system/
├── .github/workflows/        # CI/CD定義
│   ├── pr-check.yml         # プルリクエストチェック
│   ├── dev-deploy.yml       # 開発環境デプロイ
│   └── prod-deploy.yml      # 本番環境デプロイ
├── terraform/                # インフラ定義
│   ├── environments/
│   │   ├── dev/
│   │   │   ├── main.tf
│   │   │   ├── variables.tf
│   │   │   └── outputs.tf
│   │   └── prod/
│   └── modules/
│       ├── network/
│       ├── aurora/
│       ├── s3/
│       └── iam/
├── sam-lambda/               # Lambda関数
│   ├── src/
│   │   ├── controllers/     # プレゼンテーション層
│   │   ├── application/     # アプリケーション層
│   │   ├── domain/          # ドメイン層
│   │   └── infrastructure/  # インフラストラクチャ層
│   ├── layers/              # Lambda Layers
│   ├── tests/               # テストコード
│   ├── template.yaml        # SAMテンプレート
│   ├── samconfig.toml       # SAM設定
│   └── package.json         # Node.js依存関係
├── local-env/                # ローカル開発環境
│   ├── local-s3/            # S3代替
│   ├── postgresql/          # Aurora代替
│   ├── dynamodb-local/      # DynamoDB代替
│   └── scripts/             # 環境管理スクリプト
├── docs/                     # ドキュメント
│   ├── api/                 # API仕様書
│   ├── architecture/        # アーキテクチャ図
│   └── deployment/          # デプロイ手順
├── scripts/                  # 各種スクリプト
│   ├── deploy.sh            # デプロイスクリプト
│   ├── setup-local.sh       # ローカル環境セットアップ
│   └── test.sh              # テスト実行スクリプト
├── .gitignore               # Git除外設定
├── README.md                # プロジェクト概要
├── package.json             # プロジェクト依存関係
└── LICENSE                  # ライセンス（オプション）
```

### 6.2 初期ファイル作成手順

#### 1. developブランチ作成・切り替え
```bash
git checkout -b develop
```

#### 2. ディレクトリ構成作成
```bash
# 基本ディレクトリ作成
mkdir -p .github/workflows
mkdir -p terraform/environments/{dev,prod}
mkdir -p terraform/modules/{network,aurora,s3,iam}
mkdir -p sam-lambda/{src/{controllers,application,domain,infrastructure},layers,tests}
mkdir -p local-env/{local-s3,postgresql,dynamodb-local,scripts}
mkdir -p docs/{api,architecture,deployment}
mkdir -p scripts
```

#### 3. 基本ファイル作成
```bash
# README.md更新
cat > README.md << 'EOF'
# CSVファイル並列処理システム

AWS Lambda + Step Functionsを使用したCSVファイル並列処理システム

## アーキテクチャ概要

- **CSV検証**: アップロードされたCSVファイルの妥当性チェック
- **並列処理**: Step Functions分散マップによる大容量CSV並列処理  
- **監査ログ**: DynamoDBによる処理履歴管理
- **データ保存**: Aurora PostgreSQLによるデータ永続化

## 技術スタック

- **インフラ**: AWS (Lambda, Step Functions, S3, DynamoDB, Aurora)
- **IaC**: Terraform + AWS SAM
- **言語**: TypeScript (Node.js 18.x)
- **CI/CD**: GitHub Actions
- **ローカル開発**: SAM CLI + PostgreSQL + DynamoDB Local

## 開発環境セットアップ

```bash
# リポジトリクローン
git clone https://github.com/taiki-nakamoto/csv-parallel-processing-system.git
cd csv-parallel-processing-system

# ローカル環境セットアップ
./scripts/setup-local.sh
```

## デプロイ

```bash
# 開発環境デプロイ
./scripts/deploy.sh dev

# 本番環境デプロイ
./scripts/deploy.sh prod
```

EOF

# .gitignore更新
cat >> .gitignore << 'EOF'

# Project specific
local-env/postgresql/data/
local-env/dynamodb-local/data/
*.tfstate
*.tfstate.backup
.terraform/
.terraform.lock.hcl

# SAM
.aws-sam/
samconfig.toml

# Environment variables
.env
.env.local
.env.*.local

# IDE
.vscode/
.idea/

# OS
.DS_Store
Thumbs.db
EOF
```

#### 4. コミット・プッシュ
```bash
git add .
git commit -m "初期プロジェクト構成作成

- ディレクトリ構成作成
- README.md更新
- .gitignore更新
"
git push origin develop
```

## 7. GitHub Actions基本ワークフロー作成

### 7.1 プルリクエストチェック（.github/workflows/pr-check.yml）

```yaml
name: Pull Request Check

on:
  pull_request:
    branches: [ main, develop ]

jobs:
  terraform-check:
    name: Terraform Check
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v2
        
      - name: Terraform Format Check
        run: terraform fmt -check -recursive terraform/
        
      - name: Terraform Validate
        run: |
          cd terraform/environments/dev
          terraform init -backend=false
          terraform validate

  sam-check:
    name: SAM Check
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          
      - name: Install dependencies
        run: |
          cd sam-lambda
          npm install
          
      - name: Run tests
        run: |
          cd sam-lambda
          npm run test
          
      - name: SAM Build
        run: |
          cd sam-lambda
          sam build
```

### 7.2 開発環境デプロイ（.github/workflows/dev-deploy.yml）

```yaml
name: Deploy to Development

on:
  push:
    branches: [ develop ]

env:
  AWS_REGION: ${{ secrets.AWS_REGION }}

jobs:
  deploy-infrastructure:
    name: Deploy Infrastructure
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Configure AWS credentials
        uses: aws-actions/configure-aws-credentials@v2
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-region: ${{ secrets.AWS_REGION }}
          
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v2
        
      - name: Terraform Apply
        run: |
          cd terraform/environments/dev
          terraform init
          terraform plan
          terraform apply -auto-approve

  deploy-lambda:
    name: Deploy Lambda Functions
    needs: deploy-infrastructure
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Configure AWS credentials
        uses: aws-actions/configure-aws-credentials@v2
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-region: ${{ secrets.AWS_REGION }}
          
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          
      - name: SAM Deploy
        run: |
          cd sam-lambda
          sam build
          sam deploy --no-confirm-changeset --no-fail-on-empty-changeset
```

## 8. 作業実行計画

### 8.1 実行順序
1. **GitHubリポジトリ作成** (Web画面操作)
2. **ローカル環境との接続** (Git操作)
3. **ブランチ戦略実装** (developブランチ作成)
4. **初期ディレクトリ構成作成** (ファイル・ディレクトリ作成)
5. **GitHub Actions基本ワークフロー作成** (YAML作成)
6. **ブランチ保護設定** (Web画面操作)
7. **GitHub Actions Secrets設定** (Web画面操作)
8. **初期プルリクエスト作成・マージ** (動作確認)

### 8.2 作業時間見積もり
- GitHubリポジトリ作成: 10分
- ローカル環境接続: 5分
- 初期構成作成: 20分
- GitHub Actions作成: 15分
- ブランチ保護・Secrets設定: 15分
- **合計**: 約65分

### 8.3 確認項目
- [ ] リポジトリが正常に作成されている
- [ ] ローカルからプッシュできる
- [ ] ブランチ保護が機能している
- [ ] GitHub Actionsが正常に動作する
- [ ] Secretsが正しく設定されている

## 9. 注意事項・リスク

### 9.1 セキュリティ考慮事項
- **Secrets管理**: AWSアクセスキーは適切にSecretsで管理
- **ブランチ保護**: 直接pushを防ぐ設定を必須とする
- **プライベートリポジトリ**: ソースコード保護のため必須

### 9.2 運用考慮事項
- **アクセスキー更新**: 定期的なアクセスキーローテーション
- **ブランチ戦略**: GitFlowの徹底運用
- **レビュープロセス**: プルリクエストレビューの実施

### 9.3 トラブルシューティング
- **認証エラー**: Secrets設定の確認
- **ワークフローエラー**: ログの詳細確認
- **ブランチ保護エラー**: 設定内容の再確認

## 10. 次のステップ

GitHub環境準備完了後の作業：
1. **開発ツール準備**: SAM CLI、Terraform等のインストール確認
2. **インフラ製造開始**: Terraformによるインフラ構築
3. **SAMアプリケーション開発**: Lambda関数実装開始

---

**作成日**: 2025-08-04  
**承認**: システム開発チーム  
**次回レビュー**: GitHub環境準備完了後