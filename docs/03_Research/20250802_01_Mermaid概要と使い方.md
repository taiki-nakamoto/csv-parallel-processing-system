# Mermaid概要と使い方

## 1. Mermaidとは

Mermaidは、テキストベースの図表作成ツールです。マークダウン形式のシンプルな記法で、フローチャート、シーケンス図、ガントチャート、クラス図などの様々な図表を作成できます。

### 主な特徴
- **テキストベース**: コードで図を定義するため、バージョン管理が容易
- **リアルタイム描画**: 記述した内容が即座に図として表示される
- **多様な図表タイプ**: ビジネス図表から技術図表まで幅広くサポート
- **統合性**: GitHub、GitLab、多くのマークダウンエディタで直接レンダリング可能

## 2. 基本的な使い方

### 2.1 マークダウンでの記述方法

````markdown
```mermaid
graph TD
    A[開始] --> B[処理]
    B --> C[終了]
```
````

### 2.2 対応環境
- GitHub/GitLab（自動レンダリング）
- VS Code（拡張機能）
- Notion
- Obsidian
- オンラインエディタ（mermaid.live）

## 3. 主要な図表タイプ

### 3.1 フローチャート（graph/flowchart）

基本的な方向指定：
- `TB` / `TD`: 上から下（Top to Bottom / Top Down）
- `BT`: 下から上（Bottom to Top）
- `RL`: 右から左（Right to Left）
- `LR`: 左から右（Left to Right）

```mermaid
graph LR
    A[四角形] --> B{ひし形}
    B -->|Yes| C[処理1]
    B -->|No| D[処理2]
    C --> E((円形))
    D --> E
```

### 3.2 シーケンス図（sequenceDiagram）

```mermaid
sequenceDiagram
    participant ユーザー
    participant システム
    participant データベース
    
    ユーザー->>システム: ログイン要求
    システム->>データベース: 認証情報確認
    データベース-->>システム: 認証結果
    alt 認証成功
        システム-->>ユーザー: ログイン成功
    else 認証失敗
        システム-->>ユーザー: ログイン失敗
    end
```

### 3.3 クラス図（classDiagram）

```mermaid
classDiagram
    class Animal {
        +String name
        +int age
        +eat()
        +sleep()
    }
    
    class Dog {
        +String breed
        +bark()
    }
    
    class Cat {
        +String color
        +meow()
    }
    
    Animal <|-- Dog
    Animal <|-- Cat
```

### 3.4 状態図（stateDiagram）

```mermaid
stateDiagram-v2
    [*] --> 待機中
    待機中 --> 処理中: 開始
    処理中 --> エラー: 異常発生
    処理中 --> 完了: 正常終了
    エラー --> 待機中: リセット
    完了 --> [*]
```

### 3.5 ガントチャート（gantt）

```mermaid
gantt
    title プロジェクトスケジュール
    dateFormat  YYYY-MM-DD
    section 設計フェーズ
    要件定義           :a1, 2024-01-01, 30d
    基本設計           :a2, after a1, 20d
    詳細設計           :a3, after a2, 20d
    section 開発フェーズ
    実装               :b1, after a3, 60d
    単体テスト         :b2, after b1, 20d
    section テストフェーズ
    結合テスト         :c1, after b2, 30d
    システムテスト     :c2, after c1, 20d
```

### 3.6 円グラフ（pie）

```mermaid
pie title 売上構成比
    "製品A" : 45
    "製品B" : 25
    "製品C" : 20
    "その他" : 10
```

### 3.7 ER図（erDiagram）

```mermaid
erDiagram
    USER ||--o{ ORDER : places
    USER {
        int id PK
        string name
        string email
        date created_at
    }
    ORDER ||--|{ ORDER_ITEM : contains
    ORDER {
        int id PK
        int user_id FK
        date order_date
        string status
    }
    PRODUCT ||--o{ ORDER_ITEM : "is in"
    PRODUCT {
        int id PK
        string name
        decimal price
        int stock
    }
    ORDER_ITEM {
        int order_id FK
        int product_id FK
        int quantity
        decimal unit_price
    }
```

## 4. ノード（図形）の種類

### 4.1 基本図形

```mermaid
graph TB
    A[四角形/長方形]
    B(角丸四角形)
    C((円形))
    D{ひし形/判断}
    E>フラグ型]
    F[/平行四辺形/]
    G[\逆平行四辺形\]
    H[/台形\]
    I[\逆台形/]
```

### 4.2 特殊図形

```mermaid
graph TB
    A{{六角形}}
    B([スタジアム型])
    C[[サブルーチン]]
    D[(データベース)]
    E(((円形強調)))
```

## 5. 矢印とリンクのスタイル

### 5.1 矢印の種類

```mermaid
graph LR
    A --> B
    B --- C
    C -.-> D
    D ==> E
    E -.テキスト付き点線.-> F
    F ==太い矢印==> G
```

### 5.2 リンクの長さ調整

```mermaid
graph TD
    A -->|通常| B
    A --->|長め| C
    A ---->|さらに長め| D
```

## 6. スタイリングとテーマ

### 6.1 ノードのスタイル定義

```mermaid
graph LR
    A[重要なノード]
    B[通常のノード]
    C[警告ノード]
    
    style A fill:#f9f,stroke:#333,stroke-width:4px
    style C fill:#ff9999,stroke:#ff0000,stroke-width:2px
```

### 6.2 クラスの使用

```mermaid
graph TB
    A[開始]:::startClass
    B[処理]
    C[終了]:::endClass
    
    A --> B --> C
    
    classDef startClass fill:#9f9,stroke:#393,stroke-width:2px
    classDef endClass fill:#f99,stroke:#933,stroke-width:2px
```

## 7. 実践的な使用例

### 7.1 AWS アーキテクチャ図

```mermaid
graph TB
    subgraph "AWS Cloud"
        subgraph "VPC"
            ALB[Application<br/>Load Balancer]
            subgraph "Public Subnet"
                EC2_1[EC2<br/>Web Server]
                EC2_2[EC2<br/>Web Server]
            end
            subgraph "Private Subnet"
                RDS[(RDS<br/>Database)]
            end
        end
        S3[S3<br/>Static Assets]
        CF[CloudFront<br/>CDN]
    end
    
    Users[ユーザー] --> CF
    CF --> S3
    Users --> ALB
    ALB --> EC2_1
    ALB --> EC2_2
    EC2_1 --> RDS
    EC2_2 --> RDS
```

### 7.2 CI/CDパイプライン

```mermaid
graph LR
    A[Git Push] --> B[GitHub]
    B --> C{GitHub Actions}
    C -->|テスト| D[単体テスト]
    C -->|ビルド| E[Docker Build]
    D --> F{テスト結果}
    E --> G[ECR Push]
    F -->|成功| G
    F -->|失敗| H[通知]
    G --> I[ECS Deploy]
    I --> J[本番環境]
```

## 8. Tips とベストプラクティス

### 8.1 可読性の向上
- ノードIDは意味のある名前を使用
- 複雑な図は`subgraph`で構造化
- 適切な方向（TD/LR）を選択

### 8.2 メンテナンス性
- コメントを活用（`%% コメント %%`）
- 一貫性のある命名規則
- 図が大きくなりすぎないよう分割

### 8.3 トラブルシューティング
- 特殊文字はエスケープまたは引用符で囲む
- 日本語は問題なく使用可能
- 構文エラーは行番号で特定可能

## 9. オンラインリソース

- 公式ドキュメント: https://mermaid.js.org/
- ライブエディタ: https://mermaid.live/
- GitHub統合: マークダウンファイルで自動レンダリング
- VS Code拡張: Mermaid Preview

## 10. まとめ

Mermaidは、エンジニアリング文書やプレゼンテーションで図を作成する際の強力なツールです。テキストベースであるため、コードと同じようにバージョン管理でき、レビューやコラボレーションも容易です。基本的な構文を覚えれば、複雑な図表も効率的に作成できます。