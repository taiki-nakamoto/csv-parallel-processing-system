# æ­£å¸¸ç³»ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå‰ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

## ğŸ“‹ å®Ÿè¡Œæ—¥: 2025å¹´8æœˆ7æ—¥

### ğŸ”§ ã‚¤ãƒ³ãƒ•ãƒ©æº–å‚™çŠ¶æ³

#### AWSåŸºç›¤ãƒªã‚½ãƒ¼ã‚¹
- [x] Aurora PostgreSQLç¨¼åƒä¸­
  - `csv-parallel-processing-aurora-dev.cluster-cbuqsk2gi5o4.ap-northeast-1.rds.amazonaws.com`
- [x] DynamoDB ãƒ†ãƒ¼ãƒ–ãƒ«4ã¤ç¨¼åƒä¸­ 
  - audit-logs, processing-metadata, batch-jobs, job-locks
- [x] S3ãƒã‚±ãƒƒãƒˆæº–å‚™å®Œäº†
  - `csv-processing-526636471122-dev`
- [x] Step Functions StateMachine Active
  - `csv-parallel-processing-csv-processing-dev`

#### Lambdaé–¢æ•°è¨­å®š
- [x] **é‡è¦**: ç’°å¢ƒå¤‰æ•°è¨­å®šå®Œäº†ï¼ˆS3_BUCKET_NAME, AURORA_ENDPOINTç­‰ï¼‰
- [x] **é‡è¦**: VPCè¨­å®šæœ‰åŠ¹åŒ–ï¼ˆAuroraæ¥ç¶šç”¨ï¼‰
- [x] IAMãƒ­ãƒ¼ãƒ«æ¨©é™ç¢ºèªï¼ˆTerraformä½œæˆãƒ­ãƒ¼ãƒ«ä½¿ç”¨ï¼‰
- [x] Lambda Layersé©ç”¨æ¸ˆã¿

#### EventBridgeè¨­å®š
- [x] S3ã‚¤ãƒ™ãƒ³ãƒˆé€šçŸ¥æœ‰åŠ¹
- [x] EventBridgeãƒ«ãƒ¼ãƒ«ä½œæˆæ¸ˆã¿
- [x] Step Functionsã‚¿ãƒ¼ã‚²ãƒƒãƒˆè¨­å®šæ¸ˆã¿

### ğŸ’¾ ãƒ‡ãƒ¼ã‚¿æº–å‚™çŠ¶æ³

#### Aurora PostgreSQL
**ğŸš¨æœ€é‡è¦**: ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼100ä»¶ç™»éŒ²æ‰‹é †
  
  **âš ï¸é‡è¦**: ãƒ¦ãƒ¼ã‚¶ãƒ¼æœªç™»éŒ²ã®å ´åˆã€å…¨ãƒ¬ã‚³ãƒ¼ãƒ‰å‡¦ç†ãŒ`UserNotFoundError`ã§å¤±æ•—ã—ã¾ã™ï¼
  
  **1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶š:**
  ```bash
  # Auroraæ¥ç¶šæƒ…å ±å–å¾—
  aws secretsmanager get-secret-value \
    --secret-id "arn:aws:secretsmanager:ap-northeast-1:526636471122:secret:rds!cluster-9473744a-7f41-4d4e-88d7-427a8d09eadd-hOXGZz" \
    --query SecretString --output text | jq
  
  # psqlæ¥ç¶šä¾‹
  psql -h csv-parallel-processing-aurora-dev.cluster-cbuqsk2gi5o4.ap-northeast-1.rds.amazonaws.com \
       -U postgres -d csvbatch
  ```
  
  **2. ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆSQLå®Ÿè¡Œ:**
  ```sql
  -- ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼U00001ï½U00100ã®100ä»¶ä¸€æ‹¬ç™»éŒ²
  INSERT INTO users (user_id, username, email, created_at, updated_at, is_active, metadata) VALUES
  ('U00001', 'testuser001', 'test001@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00002', 'testuser002', 'test002@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00003', 'testuser003', 'test003@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00004', 'testuser004', 'test004@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00005', 'testuser005', 'test005@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00006', 'testuser006', 'test006@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00007', 'testuser007', 'test007@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00008', 'testuser008', 'test008@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00009', 'testuser009', 'test009@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00010', 'testuser010', 'test010@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00011', 'testuser011', 'test011@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00012', 'testuser012', 'test012@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00013', 'testuser013', 'test013@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00014', 'testuser014', 'test014@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00015', 'testuser015', 'test015@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00016', 'testuser016', 'test016@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00017', 'testuser017', 'test017@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00018', 'testuser018', 'test018@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00019', 'testuser019', 'test019@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00020', 'testuser020', 'test020@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00021', 'testuser021', 'test021@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00022', 'testuser022', 'test022@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00023', 'testuser023', 'test023@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00024', 'testuser024', 'test024@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00025', 'testuser025', 'test025@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00026', 'testuser026', 'test026@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00027', 'testuser027', 'test027@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00028', 'testuser028', 'test028@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00029', 'testuser029', 'test029@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00030', 'testuser030', 'test030@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00031', 'testuser031', 'test031@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00032', 'testuser032', 'test032@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00033', 'testuser033', 'test033@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00034', 'testuser034', 'test034@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00035', 'testuser035', 'test035@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00036', 'testuser036', 'test036@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00037', 'testuser037', 'test037@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00038', 'testuser038', 'test038@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00039', 'testuser039', 'test039@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00040', 'testuser040', 'test040@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00041', 'testuser041', 'test041@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00042', 'testuser042', 'test042@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00043', 'testuser043', 'test043@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00044', 'testuser044', 'test044@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00045', 'testuser045', 'test045@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00046', 'testuser046', 'test046@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00047', 'testuser047', 'test047@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00048', 'testuser048', 'test048@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00049', 'testuser049', 'test049@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00050', 'testuser050', 'test050@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00051', 'testuser051', 'test051@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00052', 'testuser052', 'test052@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00053', 'testuser053', 'test053@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00054', 'testuser054', 'test054@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00055', 'testuser055', 'test055@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00056', 'testuser056', 'test056@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00057', 'testuser057', 'test057@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00058', 'testuser058', 'test058@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00059', 'testuser059', 'test059@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00060', 'testuser060', 'test060@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00061', 'testuser061', 'test061@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00062', 'testuser062', 'test062@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00063', 'testuser063', 'test063@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00064', 'testuser064', 'test064@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00065', 'testuser065', 'test065@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00066', 'testuser066', 'test066@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00067', 'testuser067', 'test067@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00068', 'testuser068', 'test068@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00069', 'testuser069', 'test069@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00070', 'testuser070', 'test070@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00071', 'testuser071', 'test071@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00072', 'testuser072', 'test072@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00073', 'testuser073', 'test073@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00074', 'testuser074', 'test074@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00075', 'testuser075', 'test075@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00076', 'testuser076', 'test076@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00077', 'testuser077', 'test077@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00078', 'testuser078', 'test078@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00079', 'testuser079', 'test079@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00080', 'testuser080', 'test080@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00081', 'testuser081', 'test081@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00082', 'testuser082', 'test082@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00083', 'testuser083', 'test083@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00084', 'testuser084', 'test084@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00085', 'testuser085', 'test085@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00086', 'testuser086', 'test086@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00087', 'testuser087', 'test087@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00088', 'testuser088', 'test088@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00089', 'testuser089', 'test089@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00090', 'testuser090', 'test090@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00091', 'testuser091', 'test091@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00092', 'testuser092', 'test092@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00093', 'testuser093', 'test093@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00094', 'testuser094', 'test094@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00095', 'testuser095', 'test095@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00096', 'testuser096', 'test096@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00097', 'testuser097', 'test097@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00098', 'testuser098', 'test098@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00099', 'testuser099', 'test099@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}'),
  ('U00100', 'testuser100', 'test100@example.com', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, TRUE, '{}');
  ```
  
  **3. ç™»éŒ²ç¢ºèª:**
  ```sql
  -- ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²æ•°ç¢ºèªï¼ˆçµæœ: 100ã§ã‚ã‚‹ã“ã¨ï¼‰
  SELECT COUNT(*) FROM users WHERE user_id LIKE 'U00%';
  
  -- ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ç¢ºèª
  SELECT user_id, username, email, is_active 
  FROM users 
  WHERE user_id IN ('U00001', 'U00050', 'U00100') 
  ORDER BY user_id;
  
  -- å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼IDä¸€è¦§è¡¨ç¤ºï¼ˆæœ€åˆã®10ä»¶ï¼‰
  SELECT user_id, username 
  FROM users 
  WHERE user_id LIKE 'U00%' 
  ORDER BY user_id 
  LIMIT 10;
  ```
  
**user_statisticsãƒ†ãƒ¼ãƒ–ãƒ«åˆæœŸåŒ–æ‰‹é †**
  
  **æ—¢å­˜ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢:**
  ```sql
  -- ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ—¢å­˜çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤
  DELETE FROM user_statistics WHERE user_id LIKE 'U00%';
  ```
  
  **åˆæœŸåŒ–ç¢ºèª:**
  ```sql
  -- ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã®çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ãŒ0ä»¶ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
  SELECT COUNT(*) FROM user_statistics WHERE user_id LIKE 'U00%';
  -- çµæœ: 0
  
  -- user_statisticsãƒ†ãƒ¼ãƒ–ãƒ«ã®å…¨ä½“çŠ¶æ³ç¢ºèª
  SELECT COUNT(*) AS total_records FROM user_statistics;
  ```

#### ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
- [x] CSV ãƒ•ã‚¡ã‚¤ãƒ«æº–å‚™å®Œäº†
  - ãƒ•ã‚¡ã‚¤ãƒ«å: `test-user-stats-20250807-100records.csv`  
  - ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°: 100ä»¶ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼å«ã‚€101è¡Œï¼‰
  - ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ: `ãƒ¦ãƒ¼ã‚¶ãƒ¼ID,ãƒ­ã‚°ã‚¤ãƒ³å›æ•°,æŠ•ç¨¿å›æ•°`

### ğŸš¨ é‡è¦ãªæ—¢çŸ¥èª²é¡Œ

#### äº‹å‰å¯¾å¿œå¿…é ˆé …ç›®
- [x] **æœ€é‡è¦**: Lambdaç’°å¢ƒå¤‰æ•°ã®å®Œå…¨è¨­å®š
  - âœ… ç’°å¢ƒå¤‰æ•°20å€‹å…¨ã¦è¨­å®šå®Œäº†ï¼ˆSAM template.yamlé©ç”¨æ¸ˆã¿ï¼‰
  - âœ… SAM template.yamlä¿®æ­£ãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†
- [x] **é‡è¦**: VPCè¨­å®šã®æœ‰åŠ¹åŒ–
  - âœ… Auroraæ¥ç¶šç”¨VPCè¨­å®šå®Œäº†
  - âœ… ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚µãƒ–ãƒãƒƒãƒˆ2ã¤ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—è¨­å®šæ¸ˆã¿

#### ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—è¨ˆç”»
- [x] Step Functionsæ‰‹å‹•å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰æº–å‚™æ¸ˆã¿
  - EventBridgeè‡ªå‹•èµ·å‹•ãŒå¤±æ•—ã—ãŸå ´åˆã®ä»£æ›¿æ‰‹æ®µ

### â±ï¸ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

1. **Phase 1**: äº‹å‰æº–å‚™ä¿®æ­£ï¼ˆæ¨å®š1-2æ™‚é–“ï¼‰
   - Lambdaç’°å¢ƒå¤‰æ•°è¨­å®šãƒ»VPCæœ‰åŠ¹åŒ–
   - SAMå†ãƒ‡ãƒ—ãƒ­ã‚¤
   - è¨­å®šç¢ºèªãƒ†ã‚¹ãƒˆ

2. **Phase 2**: ãƒ‡ãƒ¼ã‚¿æº–å‚™ï¼ˆæ¨å®š30åˆ†ï¼‰
   - Auroraãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²
   - åˆæœŸçŠ¶æ…‹ç¢ºèª

3. **Phase 3**: ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆæ¨å®š30åˆ†ï¼‰
   - CSVãƒ•ã‚¡ã‚¤ãƒ«S3ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
   - Step Functionså®Ÿè¡Œãƒ»ç›£è¦–
   - åŸºæœ¬å‹•ä½œç¢ºèª

4. **Phase 4**: çµæœæ¤œè¨¼ï¼ˆæ¨å®š1æ™‚é–“ï¼‰
   - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹çµæœç¢ºèª
   - ãƒ­ã‚°è©³ç´°åˆ†æ
   - æ€§èƒ½æ¸¬å®š

### ğŸ¯ æˆåŠŸåˆ¤å®šåŸºæº–

#### å¿…é ˆæ¡ä»¶

**1. Step Functions: `SUCCEEDED`ã§å®Œäº†**
- **ç¢ºèªå ´æ‰€**: AWS Console â†’ Step Functions
- **StateMachineå**: `csv-parallel-processing-csv-processing-dev`
- **ç¢ºèªæ–¹æ³•**: 
  - å®Ÿè¡Œå±¥æ­´ã§æœ€æ–°å®Ÿè¡Œã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒ`SUCCEEDED`
  - å®Ÿè¡Œæ™‚é–“ãŒ15åˆ†ä»¥å†…ã§å®Œäº†
  - å…¨ã‚¹ãƒ†ãƒƒãƒ—ãŒç·‘è‰²ï¼ˆæˆåŠŸï¼‰ã§è¡¨ç¤º

**2. Aurora: 100ãƒ¬ã‚³ãƒ¼ãƒ‰å…¨ã¦`user_statistics`ã«åæ˜ **
- **ç¢ºèªç”¨SQL**ï¼ˆ10ä»¶ã‚µãƒ³ãƒ—ãƒ«ç¢ºèªï¼‰:
```sql
-- å‡¦ç†å¾Œã®user_statisticsæ›´æ–°ç¢ºèªï¼ˆæœ€åˆã®10ä»¶ï¼‰
SELECT 
    user_id,
    login_count,
    post_count,
    updated_at,
    CASE 
        WHEN updated_at > CURRENT_TIMESTAMP - INTERVAL '1 hour' THEN 'RECENTLY_UPDATED'
        ELSE 'OLD_DATA'
    END AS update_status
FROM user_statistics 
WHERE user_id LIKE 'U00%' 
ORDER BY user_id 
LIMIT 10;

-- å…¨ä»¶æ›´æ–°ç¢ºèª
SELECT COUNT(*) as updated_records
FROM user_statistics 
WHERE user_id LIKE 'U00%' 
  AND updated_at > CURRENT_TIMESTAMP - INTERVAL '1 hour';
-- æœŸå¾…çµæœ: 100

-- CSVãƒ‡ãƒ¼ã‚¿ã¨ã®æ•´åˆæ€§ç¢ºèªï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰
SELECT 
    us.user_id,
    us.login_count,
    us.post_count
FROM user_statistics us
WHERE us.user_id IN ('U00001', 'U00002', 'U00003', 'U00050', 'U00100')
ORDER BY us.user_id;
```

**3. DynamoDB: å…¨å‡¦ç†ã®ç›£æŸ»ãƒ­ã‚°è¨˜éŒ²**
- **ç¢ºèªãƒ†ãƒ¼ãƒ–ãƒ«**: AWS Console â†’ DynamoDB â†’ ãƒ†ãƒ¼ãƒ–ãƒ«
  - `csv-parallel-processing-audit-logs-dev` - ç›£æŸ»ãƒ­ã‚°
  - `csv-parallel-processing-processing-metadata-dev` - å‡¦ç†ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
  - `csv-parallel-processing-batch-jobs-dev` - ãƒãƒƒãƒã‚¸ãƒ§ãƒ–æƒ…å ±
- **ç¢ºèªé …ç›®**:
  - audit-logs: å‡¦ç†é–‹å§‹/å®Œäº†/ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°
  - processing-metadata: CSVãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†æƒ…å ±
  - batch-jobs: ãƒãƒƒãƒå®Ÿè¡Œã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹

**4. Lambda: ã‚¨ãƒ©ãƒ¼ãªãå…¨ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ—å‡¦ç†**
- **ç¢ºèªãƒ­ã‚°**: AWS Console â†’ CloudWatch â†’ Logs â†’ ãƒ­ã‚°ã‚°ãƒ«ãƒ¼ãƒ—
- **ãƒ­ã‚°ã‚°ãƒ«ãƒ¼ãƒ—å**: `/aws/lambda/csv-parallel-processing-csv-processor-dev`
- **ã‚¨ãƒ©ãƒ¼æ¤œç´¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼**:
```
ERROR
```
ã¾ãŸã¯
```
[ERROR, WARN, FATAL]
```
ã¾ãŸã¯å…·ä½“çš„ã‚¨ãƒ©ãƒ¼æ¤œç´¢:
```
"UserNotFoundError"
```
```
"ValidationError"
```
```
"ProcessingError"
```
- **æ­£å¸¸å‡¦ç†ç¢ºèªãƒ•ã‚£ãƒ«ã‚¿ãƒ¼**:
```
"processing completed successfully"
```
```
"EVENT_PROCESSED_SUCCESSFULLY"
```

#### æ€§èƒ½ç›®æ¨™
- [ ] ç·å‡¦ç†æ™‚é–“: 15åˆ†ä»¥å†…
- [ ] ä¸¦åˆ—å‡¦ç†: æœ€å¤§5ä¸¦åˆ—ã§å®Ÿè¡Œ
- [ ] ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§: 0ä»¶ã®ãƒ‡ãƒ¼ã‚¿ä¸æ•´åˆ

### ğŸš§ ãƒªã‚¹ã‚¯è©•ä¾¡

#### é«˜ãƒªã‚¹ã‚¯é …ç›®
- **Auroraæ¥ç¶šã‚¨ãƒ©ãƒ¼**: VPCæœªè¨­å®šã«ã‚ˆã‚‹æ¥ç¶šå¤±æ•—
- **ç’°å¢ƒå¤‰æ•°ä¸å‚™**: å¤–éƒ¨ãƒªã‚½ãƒ¼ã‚¹æ¥ç¶šæƒ…å ±ä¸è¶³
- **IAMæ¨©é™ä¸è¶³**: Terraform/SAMé–“ã®ãƒ­ãƒ¼ãƒ«ä¸æ•´åˆ

#### å¯¾ç­–æº–å‚™
- [x] å„ç¨®æ¥ç¶šãƒ†ã‚¹ãƒˆã‚³ãƒãƒ³ãƒ‰æº–å‚™
- [x] ã‚¨ãƒ©ãƒ¼æ™‚ã®èª¿æŸ»æ‰‹é †ç¢ºç«‹
- [x] æ‰‹å‹•å®Ÿè¡Œã§ã®ä»£æ›¿æ‰‹æ®µç¢ºä¿

### ğŸ“Š ç›£è¦–ãƒ»ç¢ºèªãƒã‚¤ãƒ³ãƒˆ

#### ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–
- [x] AWS Console Step Functionså®Ÿè¡Œç”»é¢
- [x] CloudWatch Logs Lambdaé–¢æ•°ãƒ­ã‚°
- [x] Auroraæ¥ç¶šçŠ¶æ³

#### äº‹å¾Œç¢ºèªé …ç›®
- [ ] å‡¦ç†æ™‚é–“ãƒ»ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆæ¸¬å®š
- [ ] ãƒ‡ãƒ¼ã‚¿æ­£ç¢ºæ€§æ¤œè¨¼
- [ ] ã‚¨ãƒ©ãƒ¼/è­¦å‘Šãƒ­ã‚°åˆ†æ

---

## âš¡ æœ€å„ªå…ˆå¯¾å¿œäº‹é …

### 1. Lambdaç’°å¢ƒå¤‰æ•°è¨­å®šï¼ˆå¿…é ˆï¼‰
```yaml
# template.yamlä¿®æ­£ç®‡æ‰€
Environment:
  Variables:
    S3_BUCKET_NAME: "csv-processing-526636471122-dev"
    AURORA_ENDPOINT: "csv-parallel-processing-aurora-dev.cluster-cbuqsk2gi5o4.ap-northeast-1.rds.amazonaws.com"
    # ãã®ä»–ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆé …ç›®ã‚’æœ‰åŠ¹åŒ–
```

### 2. VPCè¨­å®šæœ‰åŠ¹åŒ–ï¼ˆå¿…é ˆï¼‰
```yaml
# template.yamlä¿®æ­£ç®‡æ‰€  
VpcConfig:
  SecurityGroupIds:
    - "sg-06c634d551276a4ea"
  SubnetIds:
    - "subnet-08a0f6d12ec88f57b"
    - "subnet-0b5bc36627c1f6dbb"
```

### 3. Auroraäº‹å‰ãƒ‡ãƒ¼ã‚¿ç™»éŒ²ï¼ˆå¿…é ˆï¼‰
```sql
-- U00001ã‹ã‚‰U00100ã¾ã§ã®100ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²
-- è©³ç´°ã¯æº–å‚™æ‰‹é †æ›¸å‚ç…§
```

---

**âœ… å…¨ãƒã‚§ãƒƒã‚¯å®Œäº†å¾Œã«ãƒ†ã‚¹ãƒˆå®Ÿè¡Œé–‹å§‹**

**å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰ä¾‹**:
```bash
# S3ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
aws s3 cp test-user-stats-20250807-100records.csv \
  s3://csv-processing-526636471122-dev/incoming/

# å‡¦ç†çŠ¶æ³ç¢ºèª
aws stepfunctions list-executions \
  --state-machine-arn "arn:aws:states:ap-northeast-1:526636471122:stateMachine:csv-parallel-processing-csv-processing-dev"
```