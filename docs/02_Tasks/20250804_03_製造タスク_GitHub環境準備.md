# CSVファイル並列処理システム 製造タスク_GitHub環境準備

## 1. ドキュメント情報

| 項目 | 内容 |
|------|------|
| ドキュメント名 | 製造タスク_GitHub環境準備 |
| バージョン | 1.0 |
| 作成日 | 2025-08-04 |
| 作成者 | システム開発チーム |
| 更新日 | 2025-08-04 |
| 分割元 | 20250804_01_製造タスク管理.md |

## 2. GitHub環境準備概要

### 2.1 GitHub環境準備の位置付け
製造準備フェーズの第二段階として、以下のGitHub環境準備を実施します：

1. **リポジトリ設定**: GitHubリポジトリ作成・基本設定
2. **ブランチ戦略実装**: ブランチ保護ルール・プルリクエスト設定  
3. **GitHub Actions設定**: CI/CD用のSecrets・Environments設定
4. **初期プロジェクト構成**: ディレクトリ構造・基本ファイル作成

### 2.2 参照ドキュメント
- **詳細手順**: `01_Document/04-02_製造準備_GitHub.md`
- **作業計画**: `03_Research/20250804_09_GitHub環境準備作業計画.md`
- **セキュリティ考慮事項**: `03_Research/20250804_10_Claude CodeでのGitHub作業実施可能性とセキュリティ考慮事項.md`

## 3. GitHub環境準備 ⏳未着手

### 3.1 リポジトリ設定 🔄進行中

#### GitHubアカウント情報
- **GitHubアカウント**: taiki-nakamoto
- **アカウントURL**: https://github.com/taiki-nakamoto?tab=repositories
- **アクセス権限**: 個人アカウント（フル権限）

#### GitHubリポジトリ作成 ✅完了
- [x] **基本設定**
  - [x] リポジトリ名: `csv-parallel-processing-system`
  - [x] アクセス設定: プライベートリポジトリ
  - [x] 説明文: "CSVファイル並列処理システム - AWS Lambda + Step Functions"
  - [x] 初期化: README.md、.gitignore作成

- [x] **作成手順**（手動実施必須）
  1. https://github.com/taiki-nakamoto にアクセス
  2. 「New repository」ボタンをクリック
  3. 基本情報入力・設定
  4. 「Create repository」で作成完了

#### ローカル環境接続 ✅完了  
- [x] **Git設定確認**
  ```bash
  git config --global user.name
  git config --global user.email
  ```

- [x] **リポジトリクローン**
  ```bash
  git clone https://github.com/taiki-nakamoto/csv-parallel-processing-system.git
  cd csv-parallel-processing-system
  git status
  git remote -v
  ```

#### ブランチ保護ルール設定 ⏳未着手
- [ ] **GitFlow戦略実装**
  ```
  main      ← 本番リリース用（厳格保護）
  develop   ← 開発統合用（基本保護）
  feature/* ← 機能開発用（一時的）
  hotfix/*  ← 緊急修正用（一時的）
  ```

**⚠️ 重要制限事項**: 
- **GitHubのRulesets機能**: 個人アカウントのプライベートリポジトリでは利用不可
- **利用可能範囲**: 個人アカウントはパブリックリポジトリのみ、Team/Enterpriseアカウントはプライベートリポジトリでも利用可能
- **対応方法**: 従来のBranch Protection Rules（Settings > Branches）を使用

- [ ] **mainブランチ保護設定**（手動実施必須）
  - [ ] Settings > Branches > Add rule で設定
  - [ ] Require a pull request before merging
  - [ ] Require approvals (1名以上)
  - [ ] Dismiss stale reviews when new commits are pushed
  - [ ] Require status checks to pass before merging
  - [ ] Require branches to be up to date before merging
  - [ ] Require linear history
  - [ ] Include administrators

- [ ] **developブランチ保護設定**（手動実施必須）
  - [ ] Settings > Branches > Add rule で設定
  - [ ] Require a pull request before merging
  - [ ] Require status checks to pass before merging
  - [ ] Require branches to be up to date before merging
  - [ ] Require approvals: ❌設定しない（開発効率のため）

- [x] **参照用JSONファイル**（作成済み）
  - [x] `03_Research/20250804_13_mainブランチ保護設定.json`: mainブランチ用設定
  - [x] `03_Research/20250804_14_developブランチ保護設定.json`: developブランチ用設定
  - [x] GitHub APIでの自動設定時に使用可能

### 3.2 GitHub Actions設定 🔄進行中

#### Secrets設定 ✅完了（手動実施必須）
**⚠️ セキュリティ重要**: AWS認証情報は絶対にClaude Codeに入力しない

- [x] **AWS関連Secrets**
  - [x] `AWS_ACCESS_KEY_ID`: （dev-terrarom-nakaのアクセスキー）
  - [x] `AWS_SECRET_ACCESS_KEY`: （dev-terrarom-nakaのシークレットキー）
  - [x] `AWS_REGION`: ap-northeast-1
  - [x] `S3_TFSTATE_BUCKET`: naka-enginner-tfstate
  - [x] `S3_SAM_ARTIFACTS_BUCKET`: naka-sam-artifacts

- [x] **Secrets設定手順**（手動実施必須）
  1. Settings > Secrets and variables > Actions
  2. New repository secret で各Secretを個別追加
  3. 入力値の検証・確認
  4. テスト実行での動作確認

#### Environments設定 ⏳未着手（将来実装）
- [ ] **Development Environment**
  - [ ] 環境名: development
  - [ ] Deployment branches: develop, feature/*
  - [ ] Environment secrets: 開発環境用設定値

- [ ] **Production Environment**
  - [ ] 環境名: production
  - [ ] Deployment branches: main
  - [ ] Required reviewers: 設定予定
  - [ ] Environment secrets: 本番環境用設定値

### 3.3 初期プロジェクト構成作成 ⏳未着手

#### ディレクトリ構成設計（devcontainer対応版）
```
csv-parallel-processing-system/
├── .devcontainer/           # VS Code Dev Container設定
│   ├── devcontainer.json    # Dev Container設定
│   ├── docker-compose.yml   # 開発環境サービス構成
│   ├── Dockerfile           # 開発コンテナイメージ
│   └── setup-scripts/       # セットアップスクリプト
│       ├── install-aws-cli.sh
│       ├── install-sam-cli.sh
│       ├── setup-minio.sh
│       └── setup-postgres.sh
├── .github/workflows/        # CI/CD定義
│   ├── pr-check.yml         # プルリクエストチェック
│   ├── dev-deploy.yml       # 開発環境デプロイ
│   └── prod-deploy.yml      # 本番環境デプロイ
├── terraform/                # インフラ定義
│   ├── environments/
│   │   ├── dev/
│   │   └── prod/
│   └── modules/
│       ├── network/
│       ├── aurora/
│       ├── s3/
│       └── iam/
├── sam/                       # Lambda関数
│   ├── src/
│   │   ├── controllers/     # プレゼンテーション層
│   │   ├── application/     # アプリケーション層
│   │   ├── domain/          # ドメイン層
│   │   └── infrastructure/  # インフラストラクチャ層
│   ├── layers/              # Lambda Layers
│   ├── tests/               # テストコード
│   ├── template.yaml        # SAMテンプレート
│   ├── samconfig.toml       # SAM設定
│   └── package.json         # Node.js依存関係
├── local-env/                # ローカル開発環境（devcontainer用）
│   ├── minio/               # MinIO（S3代替）
│   │   ├── data/           # データ永続化
│   │   └── config/         # 設定ファイル
│   ├── postgres/            # PostgreSQL（Aurora代替）
│   │   ├── data/           # データ永続化
│   │   ├── initdb/         # 初期化SQLスクリプト
│   │   └── config/         # 設定ファイル
│   ├── pgadmin/            # pgAdmin 4設定永続化
│   └── dynamodb/           # DynamoDB Local
│       └── data/           # データ永続化
├── docs/                     # プロジェクトドキュメント
│   ├── 01_Document/         # 設計書・要件定義
│   ├── 02_Tasks/            # タスク管理・進捗管理
│   ├── 03_Research/         # 技術調査・検証結果
│   ├── 10_Manual/           # 運用手順書
│   └── 99_old/              # 過去ドキュメント
├── scripts/                  # 各種スクリプト
│   ├── deploy.sh            # デプロイスクリプト
│   ├── setup-local.sh       # ローカル環境セットアップ
│   └── test.sh              # テスト実行スクリプト
├── .gitignore               # Git除外設定
├── README.md                # プロジェクト概要
├── CLAUDE.md                # Claude Code用設定
└── package.json             # プロジェクト依存関係
```

**⚠️ 重要変更点（devcontainer構成）**:
- **ローカル開発環境**: VS Code Dev Containersを採用
- **サービス構成**: 
  - S3 → MinIO（ポート5000/6001）
  - Lambda → AWS SAM Local（ポート4000/4001）
  - DynamoDB → DynamoDB Local（ポート4500）
  - Aurora → PostgreSQL（ポート5432）+ pgAdmin 4（ポート8080）
  - EventBridge → 開発環境では省略（直接呼び出し）
- **作業ディレクトリ**: `/csvworkspace`
- **詳細仕様**: `03_Research/20250804_17_devcontainer構成検討.md`参照

#### ディレクトリ・ファイル作成 ⏳未着手
- [ ] **developブランチ作成・切り替え**
  ```bash
  git checkout -b develop
  ```

- [ ] **基本ディレクトリ作成**
  ```bash
  mkdir -p .devcontainer/setup-scripts
  mkdir -p .github/workflows
  mkdir -p terraform/environments/{dev,prod}
  mkdir -p terraform/modules/{network,aurora,s3,iam}
  mkdir -p sam/{src/{controllers,application,domain,infrastructure},layers,tests}
  mkdir -p local-env/{minio/{data,config},postgres/{data,initdb,config},pgadmin,dynamodb/data}
  mkdir -p docs/{01_Document,02_Tasks,03_Research,10_Manual,99_old}
  mkdir -p scripts
  ```

- [ ] **基本ファイル作成**
  - [ ] README.md更新
  - [ ] .gitignore更新（local-env/*/data/を追加）
  - [ ] CLAUDE.md作成
  - [ ] package.json作成
  - [ ] .devcontainer/devcontainer.json作成
  - [ ] .devcontainer/docker-compose.yml作成
  - [ ] .devcontainer/Dockerfile作成
  - [ ] .devcontainer/setup-scripts/配下のスクリプト作成
  - [ ] local-env/postgres/initdb/配下の初期化SQL作成

#### CLAUDE.mdファイル作成 ⏳未着手
```markdown
# CLAUDE.md

このファイルはClaude Code用のプロジェクト設定・指示ファイルです。

## プロジェクト概要
CSVファイル並列処理システム - AWS Lambda + Step Functions

## ディレクトリ構造  
- `terraform/`: インフラ定義（Terraform）
- `sam/`: Lambda関数（TypeScript）
- `docs/`: プロジェクトドキュメント
  - `01_Document/`: 設計書・要件定義
  - `02_Tasks/`: タスク管理
  - `03_Research/`: 技術調査
  - `10_Manual/`: 運用手順書
  - `99_old/`: アーカイブ
- `local-env/`: ローカル開発環境

## コーディング規約
- TypeScript strict mode使用
- ESLint + Prettier適用
- DDD（ドメイン駆動設計）アーキテクチャ
- 単体テスト必須（Jest使用）

## デプロイ方針
- 開発環境: developブランチ → 自動デプロイ
- 本番環境: mainブランチ → 手動承認後デプロイ

## 重要な参照ドキュメント
- `docs/01_Document/`: 設計書・要件定義
  - `04-01_製造準備_AWS環境.md`: AWS環境設定
  - `04-02_製造準備_GitHub.md`: GitHub環境設定
- `docs/02_Tasks/`: タスク管理・進捗
  - `20250804_02_製造タスク_AWS環境準備.md`: AWS準備完了
  - `20250804_03_製造タスク_GitHub環境準備.md`: GitHub準備進行中
- `docs/03_Research/`: 技術調査・検証
  - `20250804_10_Claude CodeでのGitHub作業実施可能性とセキュリティ考慮事項.md`: セキュリティ方針
```

## 4. GitHub Actions基本ワークフロー作成

### 4.1 プルリクエストチェック ⏳未着手
#### .github/workflows/pr-check.yml
```yaml
name: Pull Request Check

on:
  pull_request:
    branches: [ main, develop ]

jobs:
  terraform-check:
    name: Terraform Check
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v2
        
      - name: Terraform Format Check
        run: terraform fmt -check -recursive terraform/
        
      - name: Terraform Validate
        run: |
          cd terraform/environments/dev
          terraform init -backend=false
          terraform validate

  sam-check:
    name: SAM Check
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '22'
          
      - name: Install dependencies
        run: |
          cd sam
          npm install
          
      - name: Run tests
        run: |
          cd sam
          npm run test
          
      - name: SAM Build
        run: |
          cd sam
          sam build
```

### 4.2 開発環境デプロイ ⏳未着手
#### .github/workflows/dev-deploy.yml
```yaml
name: Deploy to Development

on:
  push:
    branches: [ develop ]

env:
  AWS_REGION: ${{ secrets.AWS_REGION }}

jobs:
  deploy-infrastructure:
    name: Deploy Infrastructure
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Configure AWS credentials
        uses: aws-actions/configure-aws-credentials@v2
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-region: ${{ secrets.AWS_REGION }}
          
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v2
        
      - name: Terraform Apply
        run: |
          cd terraform/environments/dev
          terraform init
          terraform plan
          terraform apply -auto-approve

  deploy-lambda:
    name: Deploy Lambda Functions
    needs: deploy-infrastructure
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Configure AWS credentials
        uses: aws-actions/configure-aws-credentials@v2
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-region: ${{ secrets.AWS_REGION }}
          
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '22'
          
      - name: SAM Deploy
        run: |
          cd sam
          sam build
          sam deploy --no-confirm-changeset --no-fail-on-empty-changeset
```

## 5. 作業実行スケジュール

### 5.1 実行順序・時間見積もり

| No | 作業項目 | 見積時間 | 実施方法 | 状態 |
|----|----------|----------|----------|------|
| 1 | GitHubリポジトリ作成 | 10分 | 手動（Web画面） | ✅完了 |
| 2 | ローカル環境接続 | 5分 | Claude Code可 | ✅完了 |
| 3 | 初期ディレクトリ構成作成（devcontainer含む） | 30分 | Claude Code可 | ⏳未実施 |
| 4 | devcontainer設定ファイル作成 | 20分 | Claude Code可 | ⏳未実施 |
| 5 | GitHub Actions基本ワークフロー作成 | 15分 | Claude Code可 | ⏳未実施 |
| 6 | CLAUDE.mdファイル作成 | 10分 | Claude Code可 | ⏳未実施 |
| 7 | Claude Code連携設定・動作確認 | 15分 | Claude Code可 | ⏳未実施 |
| 8 | ブランチ保護設定 | 10分 | 手動（Web画面） | ⏳未実施 |
| 9 | GitHub Actions Secrets設定 | 15分 | **手動必須** | ✅完了 |
| 10 | Dev Container起動・動作確認 | 20分 | Claude Code可 | ⏳未実施 |
| 11 | 初期プルリクエスト作成・動作確認 | 10分 | Claude Code可 | ⏳未実施 |
| **合計** | **全作業** | **160分** | **混在** | **18%完了** |

### 5.2 セキュリティ重要事項
- **GitHub Actions Secrets設定**: 絶対に手動で実施
- **AWS認証情報**: Claude Codeに入力禁止
- **ブランチ保護設定**: Web画面での手動設定

## 6. 完了確認項目

### 6.1 GitHubリポジトリ確認
- [x] リポジトリが https://github.com/taiki-nakamoto/csv-parallel-processing-system で作成されている
- [x] プライベートリポジトリとして設定されている
- [x] 初期README.md、.gitignoreが作成されている

### 6.2 ローカル環境確認
- [x] ローカルからリモートリポジトリにプッシュできる
- [x] developブランチが作成・切り替えできる
- [x] git status、git remote -v が正常に動作する

### 6.3 ブランチ保護確認
- [ ] mainブランチへの直接プッシュがブロックされる
- [ ] developブランチへの直接プッシュがブロックされる
- [ ] プルリクエスト作成・マージができる

### 6.4 GitHub Actions確認
- [ ] プルリクエスト作成時にpr-check.ymlが実行される
- [ ] developブランチプッシュ時にdev-deploy.ymlが実行される
- [x] Secretsが正しく参照されている

### 6.5 Claude Code連携確認
- [ ] CLAUDE.mdファイルが適切に作成されている
- [ ] Claude CodeでGit操作が正常に動作する
- [ ] プロジェクト構造の理解が正しく行われる

### 6.6 Dev Container環境確認
- [ ] VS CodeでDev Containerが正常に起動する
- [ ] MinIO Console（http://localhost:6001）にアクセスできる
- [ ] pgAdmin 4（http://localhost:8080）にアクセスできる
- [ ] SAM Local API（http://localhost:4000）が起動できる
- [ ] DynamoDB Local（http://localhost:4500）に接続できる
- [ ] PostgreSQL（localhost:5432）に接続できる
- [ ] 各サービスのデータが永続化される

## 7. 次のステップ

### 7.1 GitHub環境準備完了後
1. **開発ツール準備**: SAM CLI、Terraform等のインストール確認
2. **インフラ製造開始**: Terraformプロジェクト初期化
3. **SAMアプリケーション開発開始**: Lambda関数実装準備

### 7.2 他の分割ドキュメント
- `20250804_04_製造タスク_インフラ製造.md` - インフラ製造フェーズ
- `20250804_05_製造タスク_開発環境構築.md` - 開発環境構築フェーズ
- `20250804_06_製造タスク_後続フェーズ.md` - その他フェーズ

## 8. 関連ドキュメント

### 8.1 詳細ドキュメント
- `01_Document/04-02_製造準備_GitHub.md` - GitHub環境準備詳細手順
- `03_Research/20250804_09_GitHub環境準備作業計画.md` - 作業計画詳細
- `03_Research/20250804_10_Claude CodeでのGitHub作業実施可能性とセキュリティ考慮事項.md` - セキュリティ方針
- `03_Research/20250804_17_devcontainer構成検討.md` - Dev Container設定詳細

### 8.2 前後のドキュメント
- `20250804_02_製造タスク_AWS環境準備.md` - 前段階（完了済み）
- `20250804_04_製造タスク_インフラ製造.md` - 次段階

---

**最終更新**: 2025-08-05  
**ステータス**: 🔄GitHub環境準備進行中（18%完了）  
**完了項目**: 
- ✅ GitHubリポジトリ作成
- ✅ ローカル環境接続  
- ✅ GitHub Actions Secrets設定
**次のアクション**: 初期ディレクトリ構成作成とdevcontainer設定  
**セキュリティ注意**: AWS認証情報は絶対にClaude Codeに入力しない  
**重要変更**: VS Code Dev Containers採用（詳細: `03_Research/20250804_17_devcontainer構成検討.md`）